<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Something Something</title>
    <link rel="stylesheet" href="css/bootstrap.min.css"/>
    <meta name="viewport" content="initial-scale=1.0">
    <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <style media="screen" type="text/css">

    * {
        margin:0;
        padding:0
      }

      body {
        background-color: #DDD;
      }

      /* #mainContainer {
        width: 800px;

        margin: 50px auto 0 auto;
        padding: 10px;

        background-color: #FFF;
      } */

      .container {
        margin:10px auto 10px auto;
        min-width: 600px;

        border:1px solid #888;
        background-color: #FFF;
      }

      .row {
        padding: 10px;
      }

      #canvasContainer {
        text-align: center;
      }

      #c {
        margin:0 auto 0 auto;
          border:1px solid #000;
      }

      #colorPickerContainer {

      }

      .color {
        background-color: #FF0000;
        display: inline-block;
        width: 30px;
        height: 30px;
      }

      .color:not(:first-child) {
        margin-left: 5px;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-light bg-light">
      <span class="navbar-brand mb-0 h1">Something Something</span>
      <form class="form-inline">
        <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
      </form>
    </nav>
    <div class="container">
      <div class="row">
        <div class="input-group">
          <input type="text" id="loadProfUrl" class="form-control" placeholder="Professor's Rate My Professor URL" value="https://www.ratemyprofessors.com/ShowRatings.jsp?tid=2163737">
          <div class="input-group-append">
            <button type="button" id="loadProfButton" class="btn btn-outline-secondary">Load Info</button>
          </div>
        </div>
      </div>
      <h1></h1>
      <div id="canvasContainer">
        <h1 id="profName">&nbsp;</h1>
        <h2 id="uniName">&nbsp;</h2>
        <canvas id="c" width="500px" height="700px"></canvas>
        <div id="colorPickerContainer"></div>
        <div id="controlsContainer">
          <form id="uploadForm" action="upload.php" method="post">
            <input type="hidden" id="profNameInput" name="profName" value="">
            <input type="hidden" id="uniNameInput" name="uniName" value="">
            <input type="hidden" id="imageDataInput" name="imageData" value="">
            <button id="uploadButton" type="button" class="btn btn-primary">Upload</button>
          </form>
        </div>
        <script type="text/javascript">
          $(document).ready(function() {
            // Initialize Canvas
            var canvas = document.getElementById('c');
            var ctx = canvas.getContext('2d');

            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 5;

            var drawing = false;

            function getXY(e) {
              var x, y;
            	// Get the mouse position relative to the <canvas> element
            	if (e.layerX || e.layerX == 0) { // Firefox
            		x = e.layerX;
            		y = e.layerY;
            	} else if (e.offsetX || e.offsetX == 0) { // Opera
            		x = e.offsetX;
            		y = e.offsetY;
            	}

              return { x: x, y: y }
            }

            canvas.addEventListener('mousedown', function(e) {
              var xy = getXY(e)

              drawing = true;

              ctx.beginPath();
              ctx.moveTo(xy.x, xy.y);

            }, false);

            canvas.addEventListener('mouseup', function(e) {
              drawing = false;

              ctx.closePath();

            });

            canvas.addEventListener('mousemove', function(e) {
              if(drawing == true) {
                var xy = getXY(e)

                ctx.lineTo(xy.x, xy.y);
                ctx.stroke();
              }
            });

            // Initialize Color Picker
            var $colorPickerContainer = $('#colorPickerContainer')
            var colors = ['#000000', '#707070', '#c99a00', '#5c4700', '#c90000', '#ffca1c', '#0e751d', '#0e75c9', '#4112b8']

            $.each(colors, function(colorIndex, color) {
              $colorPickerContainer.append(`<span class="color" style="background-color:${ color }" data-colorindex="${ colorIndex }"></span>`)
            })

            $('.color').on('click', function() {
              ctx.strokeStyle = colors[$(this).data('colorindex')];
            })

            var $profName = $('#profName')
            var $uniName = $('#uniName')

            var profName = ''
            var uniName = ''


            var $loadProfUrl = $('#loadProfUrl')
            var $loadProfButton = $('#loadProfButton')

            var $uploadButton = $('#uploadButton')

            $loadProfButton.on('click', function() {
              var profUrl = $loadProfUrl.val()
              $.ajax({
                url: profUrl,
                type: 'GET',
                crossDomain: true,
                dataType: 'html',
                success: function (response) {

                  var strippedResponse = response.replace(/src=/gi, 'nosrc=')
                  var $html = $(strippedResponse)

                  var titleA = $html.filter('title').text().split(' at ')
                  profName = titleA[0]
                  uniName = titleA[1].split(' - RateMyProfessors.com')[0]

                  $profName.html(profName)
                  $uniName.html(uniName)
                }
              });
            });

            var $uploadForm = $('#uploadForm')
            var $profNameInput = $('#profNameInput')
            var $uniNameInput = $('#uniNameInput')
            var $imageDataInput = $('#imageDataInput')

            $uploadButton.on('click', function() {
              $profNameInput.val(profName)
              $uniNameInput.val(uniName)

              var dataURL = canvas.toDataURL();
              $imageDataInput.val(dataURL)

              $uploadForm.submit()
            })
          })
        </script>
      </div>
      <div id="footer">
        a
      </div>
    </div>
  </body>
</html>
